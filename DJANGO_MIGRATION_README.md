# Django Migration Generator Usage

This document explains how to use the Django migration generator in the database designer application.

## Overview

The Django migration generator creates Django migration files from database diagrams. It supports:

1. Creating models with fields
2. Defining relationships between models
3. Generating initial migrations with all tables
4. Supporting additional operations like AlterModelOptions and RenameField

## Usage

To generate Django migrations from a diagram:

```typescript
import { generateDjangoMigration, generateDjangoMigrationString } from '@/lib/codegen/django/migration-generator';

// Generate migration files
const migrationFiles = generateDjangoMigration(diagram, {
  timestamp: '20250109120200' // Optional custom timestamp
});

// Generate formatted string output
const output = generateDjangoMigrationString(diagram, options);
```

## Features

### CreateModel Operations

The generator creates `CreateModel` operations for each table in the diagram:

- Maps database types to appropriate Django field types
- Handles primary keys, foreign keys, and other field properties
- Adds model options like ordering

### Field Type Mapping

The generator automatically maps database types to Django field types:

- `INT` → `models.IntegerField` or `models.AutoField` for primary keys
- `VARCHAR` → `models.CharField` with appropriate max_length
- `TEXT` → `models.TextField`
- Foreign keys → `models.ForeignKey` with appropriate on_delete actions

### Relationships

Foreign key relationships are detected from diagram edges and converted to Django ForeignKey fields with appropriate on_delete actions:

- CASCADE → `models.CASCADE`
- SET NULL → `models.SET_NULL`
- RESTRICT/NO ACTION → `models.PROTECT`
- SET DEFAULT → `models.SET_DEFAULT`

### Additional Operations

The generator supports additional operations like:

- `AlterModelOptions` - Change model options like ordering
- `RenameField` - Rename fields in existing models

These operations can be added by setting the environment variable `ADD_DJANGO_EXAMPLE_OPERATIONS=true` for testing purposes.

## Generated Migration Structure

Each generated migration follows the Django migration structure:

```python
# Generated by Database Designer on 2025-01-09 1202

from django.db import migrations, models
import django.db.models.deletion

class Migration(migrations.Migration):
    initial = True
    
    dependencies = [
    ]
    
    operations = [
        migrations.CreateModel(
            name='ModelName',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                # ... other fields
            ],
            options={
                'ordering': ('-field_name',),
            },
        ),
        # ... additional operations
    ]
```

## Installation in Django Project

1. Copy the generated migration files to your Django app's migrations directory
2. Run `python manage.py migrate` to execute the migrations
3. The migrations will create the exact database schema from your diagram

## Customization

You can customize the generated migrations by:

1. Modifying the diagram before generating migrations
2. Editing the generated migration files manually
3. Adding additional operations through the API

## Testing Example Operations

To generate migrations with example operations (like AlterModelOptions and RenameField):

```bash
ADD_DJANGO_EXAMPLE_OPERATIONS=true npm run your-command
```